## 当前分配器与TCMalloc的架构差异
1. **线程模型**
   - 当前分配器：单线程安全，依赖外部同步。
   - TCMalloc：线程本地缓存（ThreadCache）+ 中心堆（CentralCache）+ 页堆（PageHeap），支持无锁操作。
2. **内存管理**
   - 当前分配器：小对象通过中心自由链表（CentralFreeList）分配，大对象通过页堆（PageHeap）分配。
   - TCMalloc：小对象通过ThreadCache分配，减少锁竞争；大对象直接走PageHeap。
3. **锁策略**
   - 当前分配器：仅初始化时使用原子操作，无其他锁。
   - TCMalloc：ThreadCache无锁，CentralCache和PageHeap使用细粒度锁。

## 多线程版本实现计划
1. **引入ThreadLocal Cache**
   - 每个线程维护独立的小对象缓存（ThreadCache）。
   - 缓存满时批量归还到CentralCache，减少锁竞争。
2. **优化CentralCache**
   - 为每个尺寸类（Size Class）引入锁，支持并发操作。
   - 实现批量分配/回收接口，减少锁粒度。
3. **增强PageHeap**
   - 保持现有设计，但增加锁保护大桶跳表和地址有序链表。
4. **测试与验证**
   - 添加多线程测试用例，验证并发安全性和性能。

## 技术实现细节
1. **ThreadCache**
   - 数据结构：每个线程的缓存链表（类似CentralFreeList）。
   - 接口：`threadcache_alloc`、`threadcache_free`。
2. **CentralCache**
   - 锁策略：每个尺寸类一个自旋锁。
   - 接口：`centralcache_fetch`、`centralcache_release`。
3. **PageHeap**
   - 锁策略：全局锁保护跳表和地址链表。
   - 接口：保持现有设计，增加锁保护。

## 下一步
1. 确认计划后，开始实现ThreadCache模块。
2. 逐步优化CentralCache和PageHeap的并发支持。